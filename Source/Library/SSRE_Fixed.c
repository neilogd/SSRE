/*
Simple Software Rasterising Engine

Copyright (c) 2014 Neil Richardson (neilogd)

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/
#include "SSRE_Fixed.h"

static SSRE_Fixed_t s_SineTable[256] = 
{
	0x00000000,		// 0
	0x00000647,		// 0.024533
	0x00000c8e,		// 0.049052
	0x000012d3,		// 0.073541
	0x00001915,		// 0.097987
	0x00001f53,		// 0.122373
	0x0000258d,		// 0.146685
	0x00002bc0,		// 0.170909
	0x000031ed,		// 0.195031
	0x00003812,		// 0.219034
	0x00003e2f,		// 0.242906
	0x00004442,		// 0.266632
	0x00004a4a,		// 0.290197
	0x00005047,		// 0.313588
	0x00005637,		// 0.336790
	0x00005c1b,		// 0.359789
	0x000061f0,		// 0.382571
	0x000067b6,		// 0.405123
	0x00006d6c,		// 0.427432
	0x00007311,		// 0.449483
	0x000078a4,		// 0.471263
	0x00007e25,		// 0.492760
	0x00008392,		// 0.513960
	0x000088eb,		// 0.534850
	0x00008e2f,		// 0.555419
	0x0000935e,		// 0.575653
	0x00009875,		// 0.595541
	0x00009d75,		// 0.615070
	0x0000a25c,		// 0.634229
	0x0000a72b,		// 0.653006
	0x0000abe0,		// 0.671390
	0x0000b07a,		// 0.689370
	0x0000b4f9,		// 0.706935
	0x0000b95c,		// 0.724075
	0x0000bda3,		// 0.740778
	0x0000c1cd,		// 0.757035
	0x0000c5d8,		// 0.772837
	0x0000c9c5,		// 0.788174
	0x0000cd93,		// 0.803036
	0x0000d142,		// 0.817414
	0x0000d4d0,		// 0.831301
	0x0000d83d,		// 0.844687
	0x0000db89,		// 0.857565
	0x0000deb3,		// 0.869926
	0x0000e1bb,		// 0.881764
	0x0000e4a0,		// 0.893071
	0x0000e762,		// 0.903840
	0x0000ea00,		// 0.914065
	0x0000ec7a,		// 0.923740
	0x0000eecf,		// 0.932859
	0x0000f100,		// 0.941416
	0x0000f30c,		// 0.949407
	0x0000f4f2,		// 0.956826
	0x0000f6b3,		// 0.963669
	0x0000f84d,		// 0.969931
	0x0000f9c1,		// 0.975610
	0x0000fb0f,		// 0.980702
	0x0000fc36,		// 0.985203
	0x0000fd36,		// 0.989112
	0x0000fe0f,		// 0.992424
	0x0000fec1,		// 0.995140
	0x0000ff4c,		// 0.997256
	0x0000ffaf,		// 0.998772
	0x0000ffeb,		// 0.999687
	0x0000ffff,		// 0.999999
	0x0000ffed,		// 0.999710
	0x0000ffb2,		// 0.998819
	0x0000ff50,		// 0.997327
	0x0000fec7,		// 0.995234
	0x0000fe17,		// 0.992543
	0x0000fd3f,		// 0.989253
	0x0000fc41,		// 0.985369
	0x0000fb1b,		// 0.980891
	0x0000f9cf,		// 0.975822
	0x0000f85c,		// 0.970167
	0x0000f6c3,		// 0.963927
	0x0000f504,		// 0.957106
	0x0000f320,		// 0.949710
	0x0000f116,		// 0.941742
	0x0000eee6,		// 0.933207
	0x0000ec92,		// 0.924110
	0x0000ea19,		// 0.914457
	0x0000e77d,		// 0.904254
	0x0000e4bc,		// 0.893506
	0x0000e1d9,		// 0.882220
	0x0000ded2,		// 0.870403
	0x0000dba9,		// 0.858062
	0x0000d85f,		// 0.845205
	0x0000d4f3,		// 0.831839
	0x0000d166,		// 0.817972
	0x0000cdb9,		// 0.803612
	0x0000c9ec,		// 0.788769
	0x0000c600,		// 0.773451
	0x0000c1f6,		// 0.757667
	0x0000bdce,		// 0.741428
	0x0000b988,		// 0.724742
	0x0000b526,		// 0.707619
	0x0000b0a8,		// 0.690071
	0x0000ac0f,		// 0.672107
	0x0000a75b,		// 0.653739
	0x0000a28d,		// 0.634977
	0x00009da7,		// 0.615833
	0x000098a8,		// 0.596318
	0x00009391,		// 0.576444
	0x00008e64,		// 0.556223
	0x00008921,		// 0.535668
	0x000083c9,		// 0.514789
	0x00007e5c,		// 0.493601
	0x000078dc,		// 0.472116
	0x00007349,		// 0.450347
	0x00006da5,		// 0.428306
	0x000067f0,		// 0.406008
	0x0000622a,		// 0.383465
	0x00005c56,		// 0.360691
	0x00005673,		// 0.337701
	0x00005083,		// 0.314507
	0x00004a87,		// 0.291123
	0x0000447f,		// 0.267565
	0x00003e6c,		// 0.243845
	0x00003850,		// 0.219978
	0x0000322b,		// 0.195979
	0x00002bff,		// 0.171863
	0x000025cb,		// 0.147642
	0x00001f92,		// 0.123333
	0x00001954,		// 0.098949
	0x00001312,		// 0.074506
	0x00000cce,		// 0.050019
	0x00000687,		// 0.025501
	0x0000003f,		// 0.000967
	0xfffff9f8,		// -0.023566
	0xfffff3b1,		// -0.048086
	0xffffed6c,		// -0.072576
	0xffffe72a,		// -0.097024
	0xffffe0ec,		// -0.121412
	0xffffdab2,		// -0.145728
	0xffffd47e,		// -0.169956
	0xffffce51,		// -0.194081
	0xffffc82c,		// -0.218090
	0xffffc20f,		// -0.241968
	0xffffbbfc,		// -0.265699
	0xffffb5f3,		// -0.289271
	0xffffaff5,		// -0.312669
	0xffffaa04,		// -0.335878
	0xffffa421,		// -0.358886
	0xffff9e4b,		// -0.381677
	0xffff9884,		// -0.404238
	0xffff92ce,		// -0.426557
	0xffff8d28,		// -0.448618
	0xffff8794,		// -0.470409
	0xffff8212,		// -0.491917
	0xffff7ca4,		// -0.513129
	0xffff774a,		// -0.534032
	0xffff7205,		// -0.554614
	0xffff6cd6,		// -0.574862
	0xffff67be,		// -0.594763
	0xffff62bd,		// -0.614307
	0xffff5dd5,		// -0.633481
	0xffff5905,		// -0.652273
	0xffff544f,		// -0.670673
	0xffff4fb4,		// -0.688669
	0xffff4b34,		// -0.706250
	0xffff46cf,		// -0.723407
	0xffff4287,		// -0.740128
	0xffff3e5d,		// -0.756403
	0xffff3a50,		// -0.772223
	0xffff3662,		// -0.787578
	0xffff3293,		// -0.802459
	0xffff2ee3,		// -0.816857
	0xffff2b54,		// -0.830763
	0xffff27e5,		// -0.844169
	0xffff2498,		// -0.857067
	0xffff216c,		// -0.869449
	0xffff1e63,		// -0.881307
	0xffff1b7d,		// -0.892635
	0xffff18ba,		// -0.903426
	0xffff161a,		// -0.913672
	0xffff139f,		// -0.923369
	0xffff1147,		// -0.932510
	0xffff0f15,		// -0.941089
	0xffff0d08,		// -0.949102
	0xffff0b20,		// -0.956544
	0xffff095e,		// -0.963410
	0xffff07c2,		// -0.969696
	0xffff064d,		// -0.975398
	0xffff04fe,		// -0.980512
	0xffff03d5,		// -0.985037
	0xffff02d3,		// -0.988969
	0xffff01f9,		// -0.992305
	0xffff0145,		// -0.995044
	0xffff00b9,		// -0.997184
	0xffff0054,		// -0.998723
	0xffff0017,		// -0.999662
	0xffff0001,		// -0.999998
	0xffff0012,		// -0.999733
	0xffff004b,		// -0.998866
	0xffff00ab,		// -0.997397
	0xffff0133,		// -0.995328
	0xffff01e1,		// -0.992660
	0xffff02b8,		// -0.989395
	0xffff03b5,		// -0.985533
	0xffff04d8,		// -0.981079
	0xffff0623,		// -0.976033
	0xffff0794,		// -0.970401
	0xffff092c,		// -0.964184
	0xffff0ae9,		// -0.957386
	0xffff0ccc,		// -0.950013
	0xffff0ed5,		// -0.942067
	0xffff1103,		// -0.933554
	0xffff1356,		// -0.924480
	0xffff15cd,		// -0.914848
	0xffff1868,		// -0.904666
	0xffff1b27,		// -0.893940
	0xffff1e09,		// -0.882675
	0xffff210f,		// -0.870879
	0xffff2436,		// -0.858559
	0xffff277f,		// -0.845722
	0xffff2aea,		// -0.832375
	0xffff2e75,		// -0.818528
	0xffff3221,		// -0.804188
	0xffff35ed,		// -0.789363
	0xffff39d7,		// -0.774064
	0xffff3de1,		// -0.758299
	0xffff4208,		// -0.742077
	0xffff464c,		// -0.725408
	0xffff4aad,		// -0.708303
	0xffff4f2a,		// -0.690771
	0xffff53c2,		// -0.672823
	0xffff5875,		// -0.654471
	0xffff5d42,		// -0.635724
	0xffff6227,		// -0.616595
	0xffff6725,		// -0.597094
	0xffff6c3b,		// -0.577235
	0xffff7167,		// -0.557027
	0xffff76a9,		// -0.536484
	0xffff7c01,		// -0.515619
	0xffff816d,		// -0.494443
	0xffff86ec,		// -0.472969
	0xffff8c7e,		// -0.451210
	0xffff9222,		// -0.429180
	0xffff97d6,		// -0.406892
	0xffff9d9b,		// -0.384359
	0xffffa36f,		// -0.361594
	0xffffa951,		// -0.338611
	0xffffaf41,		// -0.315425
	0xffffb53d,		// -0.292049
	0xffffbb44,		// -0.268497
	0xffffc156,		// -0.244783
	0xffffc772,		// -0.220922
	0xffffcd97,		// -0.196928
	0xffffd3c3,		// -0.172816
	0xffffd9f6,		// -0.148599
	0xffffe02f,		// -0.124293
	0xffffe66d,		// -0.099912
	0xffffecae,		// -0.075471
	0xfffff2f3,		// -0.050985
	0xfffff93a,		// -0.026468
};

static s_TangentTable[256] = 
{
	0x00000000,		// 0
	0x00000648,		// 0.024548
	0x00000c93,		// 0.049126
	0x000012e2,		// 0.073764
	0x00001936,		// 0.098491
	0x00001f93,		// 0.123338
	0x000025f9,		// 0.148335
	0x00002c6b,		// 0.173516
	0x000032eb,		// 0.198912
	0x0000397c,		// 0.224557
	0x0000401f,		// 0.250486
	0x000046d8,		// 0.276737
	0x00004da8,		// 0.303346
	0x00005492,		// 0.330355
	0x00005b99,		// 0.357805
	0x000062c0,		// 0.385742
	0x00006a09,		// 0.414213
	0x0000717a,		// 0.443269
	0x00007914,		// 0.472964
	0x000080dc,		// 0.503357
	0x000088d5,		// 0.534511
	0x00009105,		// 0.566493
	0x00009970,		// 0.599377
	0x0000a21c,		// 0.633243
	0x0000ab0d,		// 0.668178
	0x0000b44b,		// 0.704279
	0x0000bddc,		// 0.741650
	0x0000c7c8,		// 0.780407
	0x0000d218,		// 0.820679
	0x0000dcd3,		// 0.862606
	0x0000e806,		// 0.906347
	0x0000f3bb,		// 0.952079
	0x00010000,		// 1.000000
	0x00010ce2,		// 1.050333
	0x00011a73,		// 1.103330
	0x000128c6,		// 1.159278
	0x000137ef,		// 1.218504
	0x00014808,		// 1.281382
	0x0001592d,		// 1.348344
	0x00016b7e,		// 1.419891
	0x00017f21,		// 1.496606
	0x00019444,		// 1.579173
	0x0001ab1c,		// 1.668399
	0x0001c3e7,		// 1.765247
	0x0001def1,		// 1.870868
	0x0001fc95,		// 1.986658
	0x00021d44,		// 2.114322
	0x00024186,		// 2.255963
	0x00026a09,		// 2.414212
	0x000297a7,		// 2.592401
	0x0002cb78,		// 2.794810
	0x000306ec,		// 3.027040
	0x00034beb,		// 3.296554
	0x00039d10,		// 3.613530
	0x0003fe01,		// 3.992216
	0x00047404,		// 4.453192
	0x000506fe,		// 5.027326
	0x0005c35c,		// 5.763122
	0x0006bdcd,		// 6.741424
	0x00081b94,		// 8.107741
	0x000a2731,		// 10.153096
	0x000d8e78,		// 13.556529
	0x00145ae9,		// 20.355131
	0x0028bbeb,		// 40.734054
	0x80000000,		// 1098945.874999
	0xffd7434f,		// -40.737075
	0xffeba4e5,		// -20.355886
	0xfff27172,		// -13.556864
	0xfff5d8c3,		// -10.153285
	0xfff7e464,		// -8.107863
	0xfff9422d,		// -6.741508
	0xfffa3ca0,		// -5.763185
	0xfffaf8ff,		// -5.027373
	0xfffb8bfa,		// -4.453230
	0xfffc01fd,		// -3.992247
	0xfffc62ee,		// -3.613556
	0xfffcb414,		// -3.296576
	0xfffcf913,		// -3.027059
	0xfffd3487,		// -2.794826
	0xfffd6858,		// -2.592415
	0xfffd95f6,		// -2.414225
	0xfffdbe79,		// -2.255974
	0xfffde2bc,		// -2.114331
	0xfffe036a,		// -1.986666
	0xfffe210f,		// -1.870875
	0xfffe3c19,		// -1.765252
	0xfffe54e4,		// -1.668404
	0xfffe6bbc,		// -1.579177
	0xfffe80df,		// -1.496609
	0xfffe9482,		// -1.419894
	0xfffea6d3,		// -1.348347
	0xfffeb7f8,		// -1.281384
	0xfffec810,		// -1.218505
	0xfffed73a,		// -1.159280
	0xfffee58d,		// -1.103331
	0xfffef31e,		// -1.050334
	0xffff0000,		// -1.000001
	0xffff0c45,		// -0.952080
	0xffff17fa,		// -0.906348
	0xffff232d,		// -0.862606
	0xffff2de8,		// -0.820679
	0xffff3838,		// -0.780408
	0xffff4224,		// -0.741650
	0xffff4bb5,		// -0.704279
	0xffff54f3,		// -0.668178
	0xffff5de4,		// -0.633243
	0xffff6690,		// -0.599376
	0xffff6efb,		// -0.566492
	0xffff772b,		// -0.534510
	0xffff7f24,		// -0.503357
	0xffff86ec,		// -0.472964
	0xffff8e86,		// -0.443269
	0xffff95f7,		// -0.414213
	0xffff9d41,		// -0.385742
	0xffffa467,		// -0.357805
	0xffffab6e,		// -0.330354
	0xffffb258,		// -0.303345
	0xffffb928,		// -0.276736
	0xffffbfe1,		// -0.250486
	0xffffc684,		// -0.224556
	0xffffcd15,		// -0.198911
	0xffffd395,		// -0.173515
	0xffffda07,		// -0.148334
	0xffffe06d,		// -0.123337
	0xffffe6ca,		// -0.098490
	0xffffed1e,		// -0.073763
	0xfffff36d,		// -0.049125
	0xfffff9b8,		// -0.024547
	0x00000000,		// 0.000001
	0x00000648,		// 0.024550
	0x00000c93,		// 0.049128
	0x000012e2,		// 0.073766
	0x00001936,		// 0.098493
	0x00001f93,		// 0.123340
	0x000025f9,		// 0.148337
	0x00002c6b,		// 0.173518
	0x000032ec,		// 0.198914
	0x0000397c,		// 0.224559
	0x00004020,		// 0.250489
	0x000046d8,		// 0.276739
	0x00004da8,		// 0.303349
	0x00005492,		// 0.330358
	0x00005b99,		// 0.357808
	0x000062c0,		// 0.385745
	0x00006a0a,		// 0.414216
	0x0000717a,		// 0.443272
	0x00007914,		// 0.472968
	0x000080dc,		// 0.503361
	0x000088d5,		// 0.534514
	0x00009105,		// 0.566496
	0x00009971,		// 0.599381
	0x0000a21c,		// 0.633247
	0x0000ab0e,		// 0.668183
	0x0000b44b,		// 0.704284
	0x0000bddd,		// 0.741655
	0x0000c7c9,		// 0.780413
	0x0000d218,		// 0.820684
	0x0000dcd4,		// 0.862612
	0x0000e806,		// 0.906353
	0x0000f3bb,		// 0.952086
	0x00010000,		// 1.000007
	0x00010ce3,		// 1.050340
	0x00011a74,		// 1.103338
	0x000128c7,		// 1.159286
	0x000137f0,		// 1.218512
	0x00014809,		// 1.281391
	0x0001592d,		// 1.348354
	0x00016b7e,		// 1.419902
	0x00017f22,		// 1.496618
	0x00019445,		// 1.579187
	0x0001ab1d,		// 1.668415
	0x0001c3e8,		// 1.765264
	0x0001def2,		// 1.870887
	0x0001fc97,		// 1.986680
	0x00021d45,		// 2.114346
	0x00024188,		// 2.255991
	0x00026a0b,		// 2.414245
	0x000297aa,		// 2.592438
	0x0002cb7b,		// 2.794854
	0x000306ef,		// 3.027092
	0x00034bef,		// 3.296616
	0x00039d15,		// 3.613605
	0x0003fe07,		// 3.992309
	0x0004740c,		// 4.453308
	0x00050708,		// 5.027475
	0x0005c369,		// 5.763321
	0x0006bde0,		// 6.741699
	0x00081baf,		// 8.108145
	0x000a275b,		// 10.153738
	0x000d8ec4,		// 13.557690
	0x00145b98,		// 20.357791
	0x0028beb1,		// 40.744892
	0x80000000,		// -174399.218749
	0xffd7462f,		// -40.725849
	0xffeba5a0,		// -20.353029
	0xfff271c7,		// -13.555571
	0xfff5d8f3,		// -10.152544
	0xfff7e483,		// -8.107379
	0xfff94243,		// -6.741166
	0xfffa3cb1,		// -5.762928
	0xfffaf90c,		// -5.027173
	0xfffb8c04,		// -4.453069
	0xfffc0205,		// -3.992114
	0xfffc62f6,		// -3.613444
	0xfffcb41a,		// -3.296480
	0xfffcf919,		// -3.026975
	0xfffd348c,		// -2.794753
	0xfffd685c,		// -2.592350
	0xfffd95fa,		// -2.414166
	0xfffdbe7c,		// -2.255921
	0xfffde2bf,		// -2.114284
	0xfffe036d,		// -1.986623
	0xfffe2111,		// -1.870836
	0xfffe3c1b,		// -1.765217
	0xfffe54e6,		// -1.668371
	0xfffe6bbe,		// -1.579146
	0xfffe80e1,		// -1.496581
	0xfffe9484,		// -1.419868
	0xfffea6d5,		// -1.348322
	0xfffeb7f9,		// -1.281361
	0xfffec812,		// -1.218484
	0xfffed73b,		// -1.159259
	0xfffee58e,		// -1.103312
	0xfffef31f,		// -1.050316
	0xffff0002,		// -0.999984
	0xffff0c46,		// -0.952063
	0xffff17fb,		// -0.906332
	0xffff232e,		// -0.862591
	0xffff2de9,		// -0.820665
	0xffff3839,		// -0.780394
	0xffff4225,		// -0.741637
	0xffff4bb6,		// -0.704266
	0xffff54f4,		// -0.668166
	0xffff5de5,		// -0.633230
	0xffff6691,		// -0.599365
	0xffff6efc,		// -0.566481
	0xffff772c,		// -0.534499
	0xffff7f25,		// -0.503346
	0xffff86ed,		// -0.472953
	0xffff8e87,		// -0.443258
	0xffff95f7,		// -0.414202
	0xffff9d41,		// -0.385732
	0xffffa468,		// -0.357795
	0xffffab6f,		// -0.330345
	0xffffb259,		// -0.303336
	0xffffb929,		// -0.276727
	0xffffbfe1,		// -0.250476
	0xffffc685,		// -0.224547
	0xffffcd15,		// -0.198902
	0xffffd396,		// -0.173506
	0xffffda08,		// -0.148325
	0xffffe06e,		// -0.123328
	0xffffe6ca,		// -0.098481
	0xffffed1f,		// -0.073754
	0xfffff36e,		// -0.049116
	0xfffff9b8,		// -0.024538

};

SSRE_Fixed_t SSRE_Fixed_Sqrt( SSRE_Fixed_t lhs )
{
	register u64 v = lhs;
	register u64 x = v >> 1;
	register u64 a = 0;

	if( v > 0 && x != 0 )
	{
		do
		{
			a = ( ( v << SSRE_FIXED_DOUBLE_PRECISION ) / x ) >> SSRE_FIXED_PRECISION;
			x = ( ( ( x + a ) << SSRE_FIXED_DOUBLE_PRECISION ) / SSRE_FIXED_TWO ) >> SSRE_FIXED_PRECISION;
		}
		while( ( x * x ) > ( v << SSRE_FIXED_PRECISION ) );

		return (SSRE_Fixed_t)x;
	}

	return 0;
}

SSRE_Fixed_t SSRE_Fixed_Sin( int lhs )
{
	return s_SineTable[ lhs & 0xff ];
}

SSRE_Fixed_t SSRE_Fixed_Cos( int lhs )
{
	return s_SineTable[ ( lhs + 64 ) & 0xff ];
}

SSRE_Fixed_t SSRE_Fixed_Tan( int lhs )
{
	return s_TangentTable[ lhs & 0xff ];
}
